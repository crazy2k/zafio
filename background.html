<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Un poco de background &mdash; Zafio v0.1 documentation</title>
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Zafio v0.1 documentation" href="index.html" />
    <link rel="next" title="Zafio por dentro" href="zafio.html" />
    <link rel="prev" title="Documentación de Zafio" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="zafio.html" title="Zafio por dentro"
             accesskey="N">siguiente</a> |</li>
        <li class="right" >
          <a href="index.html" title="Documentación de Zafio"
             accesskey="P">anterior</a> |</li>
        <li><a href="index.html">Zafio v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="un-poco-de-background">
<h1>Un poco de <em>background</em><a class="headerlink" href="#un-poco-de-background" title="Enlazar permanentemente con este título">¶</a></h1>
<p>La idea de este documento no es brindar explicaciones exhaustivas ni
servir de referencia absoluta de ninguno de los temas necesarios para
poder encarar un proyecto como este. Se pretende, simplemente, ofrecer
un material de apoyo a otros documentos orientado a las necesidades de
este proyecto.</p>
<p>En consecuencia, se asume que el lector tiene conocimientos previos
acerca de la arquitectura IA-32, que ha tenido cierta experiencia
previa programando en algún dialecto de <em>assembly</em> para dicha
arquitectura y que está dispuesto a buscar en otros textos lo que no
pueda encontrar aquí.</p>
<p>La arquitectura en la que se basará este proyecto es la arquitectura
IA-32 de Intel, por lo que todos los detalles de bajo nivel se
orientarán a esta.</p>
<div class="section" id="la-secuencia-de-arranque">
<h2>La secuencia de arranque<a class="headerlink" href="#la-secuencia-de-arranque" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En las computadoras compatibles con IBM PC, luego de encender la
máquina, tiene lugar la carga y ejecución de un programa, que reside en
una memoria especial de la computadora, llamado BIOS (<em>Basic
Input/Output System</em>). Generalmente, el BIOS realiza chequeos y/o
inicializaciones en el hardware y, si todo va bien, busca un
dispositivo del que pueda arrancar, siguiendo un orden de arranque que
especifica con qué dispositivo debe intentarse arrancar primero.</p>
<p>La forma que tiene el BIOS de verificar si puede arrancar de un cierto
dispositivo depende del estándar adoptado por este último. Para el
caso de los discos floppy o discos rígidos, la manera que tiene el BIOS
de saber si puede arrancar de ellos es verificando si los últimos dos
bytes del primer sector del dispositivo contienen la firma <tt class="docutils literal"><span class="pre">0xAA55</span></tt>.
<a class="footnote-reference" href="#id2" id="id1">[1]</a></p>
<p>Cuando encuentra que puede arrancar de uno de los dispositivos, entonces
copia desde él alguna pieza de código a memoria y comienza a ejecutarla.
En el caso de los discos floppy o rígidos, lo que se copia es el primer
sector, que suele tener un tamaño de 512 bytes, y se lo ubica a partir
de la dirección física <tt class="docutils literal"><span class="pre">0x7C00</span></tt>.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Para el caso de los CDs, por ejemplo, la especificación que se
sigue es otra.</td></tr>
</tbody>
</table>
<div class="section" id="el-bootloader">
<h3>El <em>bootloader</em><a class="headerlink" href="#el-bootloader" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En casi cualquier caso, el código y los datos que carga el BIOS desde
el dispositivo suele ser escaso. Por ejemplo, los 512 bytes que se
cargan de un disco floppy o rígido no alcanzan para albergar un sistema
operativo con un mínimo de funcionalidad, por mucho que uno quiera.</p>
<p>Lo que suele ocurrir, entonces, es que esa pieza de código, de algún
modo, se ocupa de cargar el resto del sistema operativo en memoria.
Eso se puede lograr en un paso, siendo ese primer código el responsable
directo de la carga del resto del sistema operativo, o, más comúnmente,
en dos o más pasos encadenados, haciendo que el primer código cargue
otra pieza de código que sí se ocupe de cargar el sistema operativo o
cargue otra pieza de código que continúe con la cadena. A las piezas
de código que se ocupan de cargar el sistema operativo se las llama
<em>bootloader</em>.</p>
<p>El <em>bootloader</em> puede hacerse tan sofisticado como se quiera: desde una
pieza de código sencilla que copia una pieza fija de código del
dispositivo a memoria, a un cargador complejo, en varias etapas, capaz
de entender varios sistemas de archivos, preparar un entorno inicial
para el sistema, permitir elegir entre varios sistemas operativos
existentes para arrancar, etc.</p>
<p>Existe una cantidad de  <em>bootloaders</em> disponibles, cada uno de ellos
con características propias. Es común, entonces, utilizar uno de los
ya existentes, en lugar de escribir el propio, cuando alguno de ellos
se adapta a las necesidades del desarrollador.</p>
<div class="section" id="grub">
<h4>GRUB<a class="headerlink" href="#grub" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Uno de los <em>bootloaders</em> más populares es GRUB. Las versiones de GRUB
suelen dividirse en las categorías &#8220;Legacy&#8221; (hasta 0.97) y GRUB 2. En
la actualidad, las versiones de GRUB más usadas, y sobre las que existe
más documentación, son las &#8220;Legacy&#8221;.</p>
<p>GRUB sigue una especificación llamada <em>Multiboot</em> <a class="reference internal" href="#multiboot">[Multiboot]</a>. Esta
especificación deja en claro, entre otras cosas, cuál es el estado de
la máquina una vez cargado el sistema operativo y qué información puede
pedirle este último al <em>bootloader</em> acerca del hardware.</p>
</div>
</div>
</div>
<div class="section" id="la-arquitectura">
<h2>La arquitectura<a class="headerlink" href="#la-arquitectura" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="modos-de-operacion">
<h3>Modos de operación<a class="headerlink" href="#modos-de-operacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La arquitectura IA-32 tiene los siguientes modos de operación:</p>
<ul>
<li><p class="first"><strong>Modo real</strong>: El modo real preserva el entorno del viejo Intel 8086,
con algunas extensiones, como las que permiten un cambio de modo. Es
el modo en el cual arranca cualquier máquina de esta arquitectura.</p>
<p>En este modo, los únicos registros de propósito &#8220;general&#8221; disponibles
son <tt class="docutils literal"><span class="pre">AX</span></tt>, <tt class="docutils literal"><span class="pre">BX</span></tt>, <tt class="docutils literal"><span class="pre">CX</span></tt>, <tt class="docutils literal"><span class="pre">DX</span></tt>, <tt class="docutils literal"><span class="pre">BP</span></tt>, <tt class="docutils literal"><span class="pre">SI</span></tt>, <tt class="docutils literal"><span class="pre">DI</span></tt> y <tt class="docutils literal"><span class="pre">SP</span></tt>,
todos de 16 bits.</p>
<p>Para el acceso a memoria, se utiliza segmentación. Las direcciones se
resuelven a partir de un registro de <img class="math" src="images/math/bda4b1a823ab94c43132c1f9be5b627d346d1a60.png" alt="segmento"/> y un <img class="math" src="images/math/7b1e0e7525cf41a63d86e97a71e329e9d647f1bc.png" alt="offset"/> a través
del siguiente cálculo: <img class="math" src="images/math/0b081b113753419883b7c448e755ba59e3a4ce69.png" alt="(segmento \cdot 16) + offset"/>. Es decir, los
registros de segmento sólo contienen información acerca del comienzo
de un segmento, pero no imponen un límite ni permisos. El espacio de
direcciones en modo real es de <img class="math" src="images/math/f6f4fb515f1d3a096a15a3bdce0db5aab3c5503f.png" alt="2^{20}"/> direcciones.</p>
</li>
<li><p class="first"><strong>Modo protegido</strong>: El modo protegido es &#8220;el modo de operación nativo
del procesador&#8221; de la arquitectura IA-32, según los manuales de
Intel. Este modo permite trabajar con un espacio de direcciones mucho
mayor y, en procesadores modernos, brinda mecanismos de protección de
memoria y anillos/niveles de ejecución.</p>
<p>En modo protegido se cuenta con los registros de próposito &#8220;general&#8221;
de 32 bits <tt class="docutils literal"><span class="pre">EAX</span></tt>, <tt class="docutils literal"><span class="pre">EBX</span></tt>, <tt class="docutils literal"><span class="pre">ECX</span></tt>, <tt class="docutils literal"><span class="pre">EDX</span></tt>, <tt class="docutils literal"><span class="pre">ESI</span></tt>, <tt class="docutils literal"><span class="pre">EDI</span></tt>,
<tt class="docutils literal"><span class="pre">EBP</span></tt> y <tt class="docutils literal"><span class="pre">ESP</span></tt>.</p>
<p>Los mecanismos de protección de memoria disponibles son segmentación
y páginación. Para la primera, los registros de segmento representan
selectores de segmento y proveen más información que los registros de
segmento en modo real.</p>
<p>Existe un pseudo-modo <strong>virtual-8086</strong>, que de momento no interesa.</p>
</li>
<li><p class="first"><strong>Modo de &#8220;gestión del sistema&#8221;</strong>: Por ahora no me interesa, pero
básicamente es un modo que permite atender mensajes o alarmas de las
que el sistema avisa a través de interrupciones.</p>
</li>
</ul>
<p>El siguiente gráfico muestra, para los modos mencionados, las maneras
de pasar de uno a otro:</p>
<p class="graphviz">
<img src="images/graphviz-140b19169261630e132303935c7e911eb3081495.png" alt="digraph modos {
    nodesep=1.7
    &quot;Modo real&quot; -&gt; &quot;Modo protegido&quot; [label=&quot;PE=1&quot;];
    &quot;Modo real&quot; -&gt; &quot;Modo de 'gestión del sistema'&quot; [label=&quot;SMI#&quot;];
    &quot;Modo protegido&quot; -&gt; &quot;Modo real&quot; [label=&quot;Reset o PE=0&quot;];
    &quot;Modo protegido&quot; -&gt; &quot;Modo de 'gestión del sistema'&quot;
        [label=&quot;SMI#&quot;];
    &quot;Modo de 'gestión del sistema'&quot; -&gt; &quot;Modo real&quot;
        [label=&quot;Reset o RSM&quot;]
    &quot;Modo de 'gestión del sistema'&quot; -&gt; &quot;Modo protegido&quot;
        [label=&quot;RSM&quot;]
}" />
</p>
</div>
<div class="section" id="administracion-de-memoria">
<h3>Administración de memoria<a class="headerlink" href="#administracion-de-memoria" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En la arquitectura IA-32 la administración de la memoria se realiza
gracias a las unidades de segmentación y paginación. Cuando la máquina
se encuentra en modo protegido, con la paginación de memoria activada,
puede pensarse en la existencia de tres tipos de direcciones, como
muestra la siguiente figura:</p>
<p class="graphviz">
<img src="images/graphviz-d1a7ca048f0c3c3fbc239a74b5d8225d2812b055.png" alt="digraph direcciones {
    rankdir=LR
    &quot;dirección virtual&quot; [shape=box]
    &quot;dirección lineal&quot; [shape=box]
    &quot;dirección física&quot; [shape=box]
    &quot;dirección virtual&quot; -&gt; &quot;dirección lineal&quot;
        [label=&lt;&lt;font point-size=&quot;12&quot;&gt;unidad&lt;br /&gt;de segmentación&lt;/font&gt;&gt;];
    &quot;dirección lineal&quot; -&gt; &quot;dirección física&quot;
        [label=&lt;&lt;font point-size=&quot;12&quot;&gt;unidad&lt;br /&gt;de paginación&lt;/font&gt;&gt;];
}" />
</p>
<p>La <strong>dirección virtual</strong> es la dirección a la que se hace referencia
generalmente desde el código. Consiste en un selector de segmento y un
<em>offset</em>. Al pasar por la unidad de segmentación, esta dirección se
transforma en una dirección en un <strong>espacio de direcciones lineal</strong>
(sin segmentos). Cuando el mecanismo de paginación se encuentra
desactivado, esta dirección coincide con la <strong>dirección física</strong>, es
decir, con la dirección que se impondrá en el <em>bus</em> de direcciones de
la máquina. Si el mecanismo de paginación está activado, entonces la
dirección lineal sufrirá una traducción más antes de llegar a ser una
dirección física.</p>
<p>El caso descripto en el párrafo anterior es un caso optimista. En
realidad, cualquiera de las dos unidades puede abortar la traducción (y
dar cuenta de ello al sistema operativo) si ocurre una falla de
protección.</p>
<div class="section" id="segmentacion">
<h4>Segmentación<a class="headerlink" href="#segmentacion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Si bien en la actualidad la segmentación sigue siendo utilizada como
mecanismo de protección de memoria, muchos sistemas operativos modernos
prefieren delegar esta tarea al mecanismo de paginación de memoria.</p>
<p>No obstante, la segmentación no puede ser desactivada en la
arquitectura IA-32, en ninguno de sus modos. ¿Cómo hacen entonces los
sistemas operativos modernos (que no precisan de la segmentación) para
desactivarla? En realidad, no la desactivan. Utilizan el llamado
&#8220;Modelo flat de segmentación&#8221;, que consiste en ubicar a todos los
segmentos ocupando todo el espacio direccionable, desde la dirección
cero. De este modo, se logra que las direcciones virtuales coincidan
con las direcciones lineales.</p>
<p>Las tablas GDT y LDT están compuestas por  <em>descriptores de segmentos</em>.
Cada uno de ellos indica la posición y el tamaño de un segmento,
junto con otros atributos de este. El descriptor de segmento tiene 64
bits de tamaño y la siguiente estructura:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="5%" />
<col width="7%" />
<col width="5%" />
<col width="7%" />
<col width="11%" />
<col width="5%" />
<col width="11%" />
<col width="5%" />
<col width="10%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Base 31:24</th>
<th class="head">G</th>
<th class="head">D/B</th>
<th class="head">L</th>
<th class="head">AVL</th>
<th class="head">Limit</th>
<th class="head">P</th>
<th class="head">DPL</th>
<th class="head">S</th>
<th class="head">Type</th>
<th class="head">Base 23:16</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>31..24</td>
<td>23</td>
<td>22</td>
<td>21</td>
<td>20</td>
<td>19..16</td>
<td>15</td>
<td>14..13</td>
<td>12</td>
<td>11..8</td>
<td>7..0</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Base 15:00</th>
<th class="head">Limit 15:00</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>31..16</td>
<td>15..0</td>
</tr>
</tbody>
</table>
<p>Los campos se interpretan según la siguiente tabla:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Campo</th>
<th class="head">Significado</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>G</td>
<td>El límite se interpreta en unidades de 1B (<tt class="docutils literal"><span class="pre">0</span></tt>) o 4KB (<tt class="docutils literal"><span class="pre">1</span></tt>)</td>
</tr>
<tr><td>D/B</td>
<td>Segmentos de 16 bits (<tt class="docutils literal"><span class="pre">0</span></tt>) o 32 bits (<tt class="docutils literal"><span class="pre">1</span></tt>)</td>
</tr>
<tr><td>L</td>
<td>Código que no es de 64 bits (<tt class="docutils literal"><span class="pre">0</span></tt>) o que es de 64 bits (<tt class="docutils literal"><span class="pre">1</span></tt>)</td>
</tr>
<tr><td>AVL</td>
<td>Es un bit disponible para usar, si se quiere</td>
</tr>
<tr><td>P</td>
<td>Segmento ausente en memoria (<tt class="docutils literal"><span class="pre">0</span></tt>) o presente en memoria (<tt class="docutils literal"><span class="pre">1</span></tt>)</td>
</tr>
<tr><td>DPL</td>
<td>Nivel de privilegio del segmento (de 0 a 3)</td>
</tr>
<tr><td>S</td>
<td>Segmento del sistema (<tt class="docutils literal"><span class="pre">0</span></tt>) o de código/datos (<tt class="docutils literal"><span class="pre">1</span></tt>)</td>
</tr>
<tr><td>Type</td>
<td>Tipo del segmento: si es de datos o de codigo; si es de
lectura o escritura/ejecutable. Ver tabla en el manual.
Valores típicos: <tt class="docutils literal"><span class="pre">0010</span></tt> (Data; Read/Write) y <tt class="docutils literal"><span class="pre">1010</span></tt> (Code;
Execute/Read))</td>
</tr>
<tr><td>Limit</td>
<td>Representa el tamaño del segmento menos uno, y se interpreta
según el valor del bit G</td>
</tr>
</tbody>
</table>
<p>Además, cuando el bit P se encuentra en <tt class="docutils literal"><span class="pre">0</span></tt>, el formato del
descriptor de segmento cambia, dejando varios bits disponibles para que
los aproveche el sistema operativo, por ejemplo, para almacenar
información acerca de dónde puede encontrarse la información del
segmento.</p>
</div>
<div class="section" id="paginacion">
<h4>Paginación<a class="headerlink" href="#paginacion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En la arquitectura IA-32 la paginación puede activarse una vez hecho el
cambio a modo protegido. Cuando se encuentra activada, y se utilizan
páginas de 4KB, la dirección lineal es dividida en tres partes por la
unidad de paginación:</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="41%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">índice en el directorio de páginas</th>
<th class="head">índice en la tabla de páginas</th>
<th class="head">offset</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>10 bits</td>
<td>10 bits</td>
<td>12 bits</td>
</tr>
</tbody>
</table>
<p>El primero de los tres campos representa un índice en el directorio de
páginas. El directorio de páginas es una tabla que contiene <img class="math" src="images/math/b3b2422eb1e019642032c00b0c5d5982903fe45d.png" alt="2^{10}"/>
entradas (una por cada índice posible). Cada entrada, además de varios
atributos, contiene la dirección física de una tabla de páginas. El
sistema de paginación utiliza el primer campo para seleccionar una de
las entradas en el directorio de páginas (<em>Page Directory Entries</em> o
PDEs). Consecuentemente, se obtendrá la dirección física de la tabla
de páginas asociada a dicha entrada.</p>
<p>El segundo campo es utilizado, entonces, para elegir una de las
<img class="math" src="images/math/b3b2422eb1e019642032c00b0c5d5982903fe45d.png" alt="2^{10}"/> entradas de la tabla de páginas mencionada. Las entradas en
la tabla de páginas (<em>Page Table Entries</em> o PTEs) contienen, además de
varios atributos, la dirección física de una página en memoria. El
offset es utilizado para seleccionar uno de los bytes en dicha página.</p>
<p>El formato de los PDEs, cuando se usan páginas de 4KB, es el siguiente:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="14%" />
<col width="8%" />
<col width="10%" />
<col width="6%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">PT Base</th>
<th class="head">AVL</th>
<th class="head">PS</th>
<th class="head">AVL</th>
<th class="head">A</th>
<th class="head">PCD</th>
<th class="head">PWT</th>
<th class="head">U/S</th>
<th class="head">R/W</th>
<th class="head">P</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>31..12</td>
<td>11..8</td>
<td>7</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Y los campos se interpretan según la siguiente tabla:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Campo</th>
<th class="head">Significado</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>PT Base</td>
<td>Dirección física de la tabla de páginas</td>
</tr>
<tr><td>AVL</td>
<td>Está disponible para usar, si se quiere</td>
</tr>
<tr><td>PS</td>
<td>Si <tt class="docutils literal"><span class="pre">CR4.PSE</span></tt> es <tt class="docutils literal"><span class="pre">1</span></tt>, indica si las páginas son de 4KB (<tt class="docutils literal"><span class="pre">0</span></tt>)
o 4MB (<tt class="docutils literal"><span class="pre">1</span></tt>); si no, se ignora (se usan páginas de 4KB)</td>
</tr>
<tr><td>A</td>
<td>Indica si la página/tabla fue accedida (<tt class="docutils literal"><span class="pre">1</span></tt>) o no (<tt class="docutils literal"><span class="pre">0</span></tt>)</td>
</tr>
<tr><td>PCD</td>
<td>Indica si la página/tabla puede ser <em>cacheada</em> (<tt class="docutils literal"><span class="pre">0</span></tt>) o no
(<tt class="docutils literal"><span class="pre">1</span></tt>)</td>
</tr>
<tr><td>PWT</td>
<td>Indica si se realizará <em>write-through</em> (<tt class="docutils literal"><span class="pre">1</span></tt>) o <em>write-back</em>
(<tt class="docutils literal"><span class="pre">0</span></tt>) de la página/tabla</td>
</tr>
<tr><td>U/S</td>
<td>Indica si el nivel de privilegios asignado a la página es de
supervisor (<tt class="docutils literal"><span class="pre">0</span></tt>) o de usuario (<tt class="docutils literal"><span class="pre">1</span></tt>)</td>
</tr>
<tr><td>R/W</td>
<td>Indica si la página es de sólo lectura (<tt class="docutils literal"><span class="pre">0</span></tt>) o puede leerse y
escribirse (<tt class="docutils literal"><span class="pre">1</span></tt>)</td>
</tr>
<tr><td>P</td>
<td>Indica si la página/tabla está ausente (<tt class="docutils literal"><span class="pre">0</span></tt>) o presente
(<tt class="docutils literal"><span class="pre">1</span></tt>) en memoria</td>
</tr>
</tbody>
</table>
<p>El formato de los PTEs, es el siguiente:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="13%" />
<col width="5%" />
<col width="9%" />
<col width="5%" />
<col width="5%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="5%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Page Base</th>
<th class="head">AVL</th>
<th class="head">G</th>
<th class="head">PAT</th>
<th class="head">D</th>
<th class="head">A</th>
<th class="head">PCD</th>
<th class="head">PWT</th>
<th class="head">U/S</th>
<th class="head">R/W</th>
<th class="head">P</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>31..12</td>
<td>11..9</td>
<td>8</td>
<td>7</td>
<td>6</td>
<td>5</td>
<td>4</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Y los campos se interpretan según la siguiente tabla:</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Campo</th>
<th class="head">Significado</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>G</td>
<td>Si <tt class="docutils literal"><span class="pre">CR4.PGE</span></tt> es <tt class="docutils literal"><span class="pre">1</span></tt>, determina si la traducción es &#8220;global&#8221;</td>
</tr>
<tr><td>PAT</td>
<td>Si PAT está soportado, determina el tipo de memoria usado para
acceder a la página</td>
</tr>
<tr><td>D</td>
<td>Indica si el software escribió en la página referenciada</td>
</tr>
</tbody>
</table>
<p>Los campos que no se hallan en esta tabla se interpretan de manera
análoga al caso del PDE.</p>
</div>
</div>
</div>
<div class="section" id="referencia-de-nasm">
<h2>Referencia de NASM<a class="headerlink" href="#referencia-de-nasm" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="directivas-del-preprocesador">
<h3>Directivas del preprocesador<a class="headerlink" href="#directivas-del-preprocesador" title="Enlazar permanentemente con este título">¶</a></h3>
<dl class="describe">
<dt>
<tt class="descname">define A x</tt></dt>
<dt>
<tt class="descname">define f(x1, x2, ...) y</tt></dt>
<dd>Permite definir macros en una sola línea. Funciona de manera
similar a las macros de C, por lo que también posibilita crear
macros con &#8220;parámetros&#8221;.</dd></dl>

</div>
<div class="section" id="directivas-del-ensamblador">
<h3>Directivas del ensamblador<a class="headerlink" href="#directivas-del-ensamblador" title="Enlazar permanentemente con este título">¶</a></h3>
<dl class="describe">
<dt>
<tt class="descname">BITS m</tt></dt>
<dd><p>Indica que el código a continuación de la directiva debe generarse
para procesadores operando en modo de <tt class="docutils literal"><span class="pre">m</span></tt> bits, donde <tt class="docutils literal"><span class="pre">m</span></tt>
puede ser 16, 32 o 64.</p>
<p>Para el modo de salida <tt class="docutils literal"><span class="pre">bin</span></tt>, que es el que usamos para el
<em>bootloader</em>, se puede asumir por omisión que <tt class="docutils literal"><span class="pre">m</span></tt> es 16. Sin
embargo, siempre es buena práctica ser explícitos con esto, en
lugar de asumir valores por omisión.</p>
</dd></dl>

<dl class="describe">
<dt>
<tt class="descname">ORG addr</tt></dt>
<dd>Hace que NASM asuma que la dirección de memoria <tt class="docutils literal"><span class="pre">addr</span></tt> es la
dirección en la que ha sido cargado el programa. NASM utiliza esta
dirección como base para todas las referencias internas en una
sección de código.</dd></dl>

</div>
</div>
<div class="section" id="referencias">
<h2>Referencias<a class="headerlink" href="#referencias" title="Enlazar permanentemente con este título">¶</a></h2>
<table class="docutils citation" frame="void" id="multiboot" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[Multiboot]</a></td><td><a class="reference external" href="http://www.gnu.org/software/grub/manual/multiboot/multiboot.html">http://www.gnu.org/software/grub/manual/multiboot/multiboot.html</a></td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="bochs" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[Bochs]</td><td><a class="reference external" href="http://bochs.sourceforge.net/">http://bochs.sourceforge.net/</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Contenidos</a></h3>
            <ul>
<li><a class="reference external" href="#">Un poco de <em>background</em></a><ul>
<li><a class="reference external" href="#la-secuencia-de-arranque">La secuencia de arranque</a><ul>
<li><a class="reference external" href="#el-bootloader">El <em>bootloader</em></a><ul>
<li><a class="reference external" href="#grub">GRUB</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#la-arquitectura">La arquitectura</a><ul>
<li><a class="reference external" href="#modos-de-operacion">Modos de operación</a></li>
<li><a class="reference external" href="#administracion-de-memoria">Administración de memoria</a><ul>
<li><a class="reference external" href="#segmentacion">Segmentación</a></li>
<li><a class="reference external" href="#paginacion">Paginación</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference external" href="#referencia-de-nasm">Referencia de NASM</a><ul>
<li><a class="reference external" href="#directivas-del-preprocesador">Directivas del preprocesador</a></li>
<li><a class="reference external" href="#directivas-del-ensamblador">Directivas del ensamblador</a></li>
</ul>
</li>
<li><a class="reference external" href="#referencias">Referencias</a></li>
</ul>
</li>
</ul>

            <h4>Tema anterior</h4>
            <p class="topless"><a href="index.html"
                                  title="Capítulo anterior">Documentación de Zafio</a></p>
            <h4>Próximo tema</h4>
            <p class="topless"><a href="zafio.html"
                                  title="Próximo capítulo">Zafio por dentro</a></p>
            <h3>Esta página</h3>
            <ul class="this-page-menu">
              <li><a href="sources/background.txt"
                     rel="nofollow">Enseñar el código</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Búsqueda rápida</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Ir a" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Introduzca los términos de búsqueda o un módulo, clase o nombre de función.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="zafio.html" title="Zafio por dentro"
             >siguiente</a> |</li>
        <li class="right" >
          <a href="index.html" title="Documentación de Zafio"
             >anterior</a> |</li>
        <li><a href="index.html">Zafio v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Pablo Antonio.
      Creado con <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>